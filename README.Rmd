#genepopedit

The goal of **genepopedit** is to provide a simple and flexible tool for
manipulating SNP datasets in R. 

**Use genepopedit to subset a SNP dataset by:**

* removing specified loci

* removing specified populations 

* removing specified individuals

* renaming populations 

* grouping populations

* extracting meta-data
    * population names
    * population counts
    * sample IDs
    * loci names

**Requirement:**
genepopedit functions through the manipulation of multi-locus SNP files structured in the *Genepop* file format <http://genepop.curtin.edu.au/>. Specifically we use the _three number_ format (e.g. 110110) where the six digits correspond two the alleles of an given locus for an individual. Loci names should be each on their own row so that the total number of rows in the _Genepop_ file equals: 

    nrows = nLOCI + nINDIVIDUALS + nPOPULATIONS - 1
    
  _or_
  
    nrows* = nLOCI + nINDIVIDUALS + nPOPULATIONS 
    
_* if STACKS version is not specified_

Most molecular based file formats can be converted to and from *Genepop* using conversion programs such as the R package _adegenet_ <https://github.com/thibautjombart/adegenet/wiki> or the program *PGDspider* <http://www.cmpg.unibe.ch/software/PGDSpider/>. 

**For example:**

*A three locus dataset with two populations and four individuals per population with the STACKS version specified*

    STACKS Version 1.0
    Loci_1
    Loci_2
    Loci_3
    Pop
    BON01  , 120120 110110 110110
    BON02  , 100100 110110 110110
    BON03  , 100100 110110 110110
    BON04  , 100100 110110 110110
    Pop
    TAG01  , 120120 110110 110110
    TAG02  , 120120 110110 110110
    TAG03  , 120120 110110 110110
    TAG04  , 120120 110110 110110

Where each row line is a single row in the input file.

## Installation
You can install **genepopedit** as a R package using the following 2 steps:

**Step 1** Install the _R_ package *devtools*
```r
if (!require("devtools")) install.packages("devtools") # to install
library(devtools) # to load
```

**Step 2** Install *genepopedit*:
```r
#Install the package from *Github*
install_github("rystanley/genepopedit") 
library(genepopedit)# load the library
```

## genepopedit functions:

##### genepop_detective.R 
* extract quick meta-data from Genepop file
    * Population names
    * Population counts
    * Sample IDs
    * Loci

##### subset_genepop.R 
* remove or keep a subset of loci 
* remove populations 

##### subset_genepop_aggregate.R
* group populations based on Genepop population tags

##### subset_genepop_rename.R
* subset and-or rename populations

##### subset_genepop_individuals.R
* remove or keep a subset of individuals

## Contributions:

This package has been develoepd to used by anyone who is looking for a more efficient and **repeatable** method to maniplate large multi-locus datasets. The package is open and I encourage you to tinker and look for improvments. I will do my best to respond to any inquiries, add additional      functions _and-or_ functionality, and improve the efficiency of the functions. 
 
* If you don’t understand something, please let me know: 
(ryan.stanley _at_ dfo-mpo.gc.ca). 
* Any ideas on how to improve the functionality is very much appreciated. 
* If you spot a typo, feel free to edit and send a pull request.

Pull request how-to: 

  * Click the edit this page on the sidebar.
  * Make the changes using github’s in-page editor and save.
  * Submit a pull request and include a brief description of your changes. (e.g. "_spelling errors_" or "_indexing error_").

## How to use genepopedit

Download the example genepop data: GenePop file with 10 populations, 30 individuals per population, and 100 Loci.
<https://www.dropbox.com/s/afhbvqmpzwru4ij/genepopedit_examplefile.txt?dl=0>

Read in the data using the following *read.table* code specifics

```r
GenePopData <- read.table("genepopedit_examplefile.txt", header = FALSE, sep = "\t", quote = "", stringsAsFactors = FALSE)
```
Set a directory where the output files will be saved.

```r
output_dir <- "c:/Users/YourName/Documents/GenePopFiles/" 
```
#genepop detective
This function meta-data from your genepop data without having to open it in a text editor. Function returns a vector of population names, population counts, sample IDs, or Loci names.

Return *population names*
```r
PopNames <- genepop_detective(GenePopData,variable="Pops")
```
Return *population counts*
```r
PopCounts <- genepop_detective(GenePopData,variable="PopNum")
```
Return *sample IDs*
```r
SampleIDs <- genepop_detective(GenePopData,variable="Inds")
```
Return *Loci names*
```r
LociNames <- genepop_detective(GenePopData,variable="Loci")
```

#subset genepop
Lets create a new Genepop file which only contains Loci *3, 15, 23, 49, 62, 81, 88, & 94*. This useful if, for example, you identify loci which are potentially under selection and want a parsed dataset. Here our loci are named in the Loci# (1:100).

```r
#inspect the names of the loci within the Genepop data
  locinames <- genepop_detective(GenePopData,"Loci")
  locinames

#subset the Genepop file and 'keep' the specified loci names ('subs')
  subset_genepop(GenePop=GenePopData,
               keep=TRUE,
               subs=c("Loci03","Loci15","Loci23","Loci49","Loci62",
               "Loci81","Loci88","Loci94"),
               dirname=paste0(output_dir,"Genepop_Loci_selection.txt"))
```

You can also choose all loci not in the vector specified using keep=FALSE.

```r
#subset the Genepop file and do not 'keep' the specified 'subs'
  subset_genepop2(GenePop=GenePopData,
               keep=FALSE,
               subs=c("Loci03","Loci15","Loci23","Loci49","Loci62",
               "Loci81","Loci88","Loci94"),
               dirname=paste0(output_dir,"Genepop_Loci_neutral.txt"))
```

You can also remove populations within this function. Here we again select loci under selection, but remove populations 3 & 7 (CCC/GGG). To do this we create a list of all populations we want to keep
(e.g. AAA, BBB, CCC ... JJJ)

```r
#use genepop_detective to find the population names
  PopNames <- genepop_detective(GenePopData,"Pops")

#create a list of populations you want to keep
  #manual
  PopKeep <- c("AAA","BBB","DDD","EEE","FFF","HHH","III","JJJ")
#or
  #if you have fewer pops to remove
  PopKeep <- setdiff(PopNames,c("CCC","GGG"))
  
  subset_genepop(GenePop=GenePopData,
                 keep=TRUE,
                 subs=c("Loci03","Loci15","Loci23","Loci49","Loci62",
                 "Loci81","Loci88","Loci94"),
                 dirname=paste0(output_dir,
                 "Genepop_Loci_selection_popsbset.txt"),sPop=PopKeep
                 )
```

#subset genepop rename
Now lets change the names of some of the populations. In this example we will rename populations DDD & HHH to YYY & ZZZ.

```r
#view the population names
  genepop_detective(GenePopData,"Pops")

#create a dataframe for renaming. 
#column 1 = the original pop names.
#column 2 = the new names. 
  PopRename <- data.frame(oPop=c("AAA","BBB","CCC","DDD","EEE","FFF","GGG","HHH","III","JJJ"),
  newname=c("AAA","BBB","CCC","YYY","EEE","FFF","GGG","ZZZ","III","JJJ"))

#rename populations
  subset_genepop_rename(GenePop=GenePopData,
                 dirname=paste0(output_dir,"Genepop_renamed.txt"),
                 nameframe=PopRename)
```

#subset genepop aggregate
Now lets change group some populations together. In this example we will combine populations DDD/EEE & FFF/HHH and remove populations JJJ/GGG (*not listed in column 1 of PopRename*). No loci will be removed from this dataframe (*subs=NULL*). This is useful when you don't want a clustering program (e.g. STRUCTURE or Bayescan) to assume differences among population groups.

```r
#Use genepop_detective to find the meta-data for populations
  genepop_detective(GenePopData,"Pops")

#create a dataframe for renaming. 
#column 1 = the original pop names and the list of pops required.
#column 2 = Grouping variables. 
  PopAggregate <-data.frame(oP=c("AAA","BBB","CCC","DDD","EEE","FFF","HHH","III"),
  agname=c("AAA","Pop1","CCC","Pop1","DDD","Pop2","HHH","Pop2"))

#re-cast Genepop format to group populations based on 'PopAggregate'
  subset_genepop_aggregate(GenePop=GenePopData,
                 subs=NULL,
                 dirname=paste0(output_dir,"Genepop_grouped.txt"),
                 agPopFrame=PopAggregatee)
```

Now that we have two grouped populations, we can use the population rename function to give them a common name.

```r
#read in the grouped Genepop file
  GenePopData2 <- read.table(paste0(output_dir,"Genepop_grouped.txt"),
  header = FALSE, sep = "\t", quote = "", stringsAsFactors = FALSE)

#investigate the population parameters
  genepop_detective(GenePopData2,"Pops")

#we can see that "BBB" & "DDD" and "FFF" & "III" are at the end but still have different names. 

#create renaming frame
  PopRename <- data.frame(oPop=c("AAA","CCC","EEE","HHH","BBB","DDD","FFF","III"),
  newname=c("AAA","CCC","EEE","HHH","Group1","Group1","Group2","Group2"))

#Rename the grouped populations
  subset_genepop_rename2(GenePop=GenePopData2,
                 dirname=paste0(output_dir,
                 "Genepop_grouped_renamed.txt""),
                 nameframe=PopRename)
```

#subset genepop individual
Remove some individual samples from the dataframe. Here we consider the 'individual' ID to be an alpha-numeric code which at the start of each row of data. The keep parameter defines whether the specified list is removed or retained (default: keep = FALSE).
_This function is best run at the beginning of the analysis prior to removal of specific loci or populations._ 

```r
#Use genepop_detective to see the naming structure.
  genepop_detective(GenePopData,"Inds")

#remove individuals.
  subset_genepop_indiv(GenePop=GenePopData,
                 indiv=c("AAA_01","AAA_03","BBB_20","CCC_21",
                 "EEE_03","EEE_26","HHH_25",JJJ_04),
                 keep=FALSE,
                 dirname=paste0(output_dir,"Genepop_IDsubset.txt"))
```
